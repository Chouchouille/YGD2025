<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Réservation RDV</title>
<script src="https://cdn.emailjs.com/dist/email.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  .slot { display: inline-block; margin: 5px; padding: 10px; border: 1px solid #333; cursor: pointer; }
  .selected { background-color: #aaf; }
  #bookingForm { display: none; margin-top: 20px; }
  input { display: block; margin: 10px 0; padding: 5px; width: 250px; }
</style>
</head>
<body>

<h1>Réserver un rendez-vous</h1>

<div id="slotsWrapper"></div>

<div id="bookingForm">
  <h3>Vos informations</h3>
  <input type="text" id="clientName" placeholder="Nom complet">
  <input type="email" id="clientEmail" placeholder="Email">
  <input type="tel" id="clientPhone" placeholder="Téléphone">
  <button id="confirmBooking">Confirmer RDV</button>
</div>

<script>
  emailjs.init("VOTRE_USER_ID_EMAILJS"); // Remplacez par votre user ID

  const slotsMock = ["09:00","10:00","11:00","14:00","15:00"];
  let selectedSlot = null;
  const slotsWrapper = document.getElementById("slotsWrapper");
  const bookingForm = document.getElementById("bookingForm");

  // Afficher les créneaux
  slotsMock.forEach(time=>{
    const slotDiv = document.createElement("div");
    slotDiv.className = "slot";
    slotDiv.innerText = time;
    slotDiv.addEventListener("click", ()=> {
      selectedSlot = time;
      document.querySelectorAll(".slot").forEach(s=>s.classList.remove("selected"));
      slotDiv.classList.add("selected");
      bookingForm.style.display = "block";
    });
    slotsWrapper.appendChild(slotDiv);
  });

  // Validation
  function validateBooking(name,email,phone){
    if(!name || !email || !phone) return "Tous les champs sont obligatoires !";
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if(!emailRegex.test(email)) return "Email invalide !";
    const phoneRegex = /^[0-9\s+()-]{6,20}$/;
    if(!phoneRegex.test(phone)) return "Téléphone invalide !";
    if(!selectedSlot) return "Veuillez choisir un créneau !";
    return null;
  }

  // Confirmer RDV
  document.getElementById("confirmBooking").addEventListener("click", ()=>{
    const name = document.getElementById("clientName").value.trim();
    const email = document.getElementById("clientEmail").value.trim();
    const phone = document.getElementById("clientPhone").value.trim();

    const error = validateBooking(name,email,phone);
    if(error){ alert(error); return; }

    emailjs.send("service_xxxxxx","template_rdv_client",{
      name: name,
      email: email,
      phone: phone,
      time: selectedSlot
    }).then(()=>{
      alert(`✅ Rendez-vous confirmé pour ${name} à ${selectedSlot}`);
      bookingForm.style.display="none";
      document.getElementById("clientName").value="";
      document.getElementById("clientEmail").value="";
      document.getElementById("clientPhone").value="";
      document.querySelectorAll(".slot").forEach(s=>s.classList.remove("selected"));
      selectedSlot = null;
    }).catch(err=>{
      console.error("Erreur EmailJS :",err);
      alert("❌ Erreur lors de l’envoi de l’e-mail de confirmation.");
    });
  });
</script>

</body>
</html>
